<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Simple WebRTC P2P DataChannel</title>
<style>
body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; }
textarea { width: 100%; height: 100px; margin-top: 5px; }
input, button { padding: 8px; margin-top: 5px; }
#messages { border: 1px solid #ccc; padding: 10px; height: 150px; overflow-y: auto; margin-top: 10px; }
</style>
</head>
<body>

<h2>WebRTC Peer to Peer Data Transfer</h2>

<button id="createOffer">Create Offer</button>
<button id="createAnswer">Create Answer</button>

<h3>Offer / Answer Exchange</h3>
<textarea id="localSDP" placeholder="Your Offer or Answer"></textarea>
<button id="copyLocal">Copy Local SDP</button>

<textarea id="remoteSDP" placeholder="Paste Remote SDP Here"></textarea>
<button id="setRemote">Set Remote SDP</button>

<h3>Send Message</h3>
<input type="text" id="messageInput" placeholder="Type message..." />
<button id="sendMessage">Send</button>

<h3>Messages</h3>
<div id="messages"></div>

<script>
let pc = new RTCPeerConnection({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] });
let channel;

// When receiving a data channel
pc.ondatachannel = e => {
  channel = e.channel;
  channel.onmessage = e => addMessage("Peer: " + e.data);
};

// Log ICE candidates automatically
pc.onicecandidate = () => {
  document.getElementById("localSDP").value = JSON.stringify(pc.localDescription);
};

function addMessage(text) {
  const div = document.getElementById("messages");
  div.innerHTML += text + "<br>";
  div.scrollTop = div.scrollHeight;
}

document.getElementById("createOffer").onclick = async () => {
  channel = pc.createDataChannel("messaging");
  channel.onmessage = e => addMessage("Peer: " + e.data);

  let offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
};

document.getElementById("createAnswer").onclick = async () => {
  let answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);
};

document.getElementById("setRemote").onclick = async () => {
  let sdp = JSON.parse(document.getElementById("remoteSDP").value);
  await pc.setRemoteDescription(sdp);
};

document.getElementById("copyLocal").onclick = () => {
  navigator.clipboard.writeText(document.getElementById("localSDP").value);
  alert("Copied!");
};

document.getElementById("sendMessage").onclick = () => {
  if (channel && channel.readyState === "open") {
    let msg = document.getElementById("messageInput").value;
    channel.send(msg);
    addMessage("You: " + msg);
    document.getElementById("messageInput").value = "";
  } else {
    alert("Connection not ready yet.");
  }
};
</script>
</body>
</html>

